<p align="center">
  <img src="https://img.shields.io/badge/言語-はじむ-ff6b6b?style=for-the-badge" alt="はじむ">
  <img src="https://img.shields.io/badge/Discord_API-v10-5865F2?style=for-the-badge&logo=discord&logoColor=white" alt="Discord API v10">
  <img src="https://img.shields.io/badge/license-MIT-green?style=for-the-badge" alt="MIT License">
  <img src="https://img.shields.io/badge/version-1.0.0-blue?style=for-the-badge" alt="v1.0.0">
</p>

# hajimu_discord — はじむ言語用 Discord Bot 開発プラグイン

**完全日本語 API で Discord Bot を開発。** discord.js や discord.py のように、はじむ言語でも直感的に Bot が書けます。

```
取り込む "hajimu_discord" として ボット

ボット.ボット作成("YOUR_TOKEN")
ボット.メッセージ受信時(関数(メッセージ)
    もし メッセージ["内容"] == "!ping" なら
        ボット.返信(メッセージ, "🏓 ポン！")
    終わり
終わり)
ボット.ボット起動()
```

**たった 8 行で動く Discord Bot。** 英語を一切知らなくても大丈夫です。

---

## 他フレームワークとの比較

| 機能 | hajimu_discord | discord.js | discord.py |
|---|---|---|---|
| 言語 | はじむ (日本語) | JavaScript | Python |
| Gateway | v10 ✅ | v10 | v10 |
| REST API | v10 ✅ | v10 | v10 |
| スラッシュコマンド | ✅ | ✅ | ✅ |
| 埋め込み (Embed) | ✅ | ✅ | ✅ |
| ボイスチャンネル | v2.0予定 | ✅ | ✅ |
| 外部依存 | libcurl + OpenSSL | Node.js | Python 3.8+ |
| API言語 | **完全日本語** | 英語 | 英語 |

---

## 📑 目次

- [インストール](#-インストール)
- [クイックスタート](#-クイックスタート)
- [チュートリアル](#-チュートリアル)
- [API リファレンス](#-api-リファレンス)
- [イベント一覧](#-イベント一覧)
- [レシピ集](#-レシピ集)
- [FAQ](#-faq)
- [変更履歴](#-変更履歴)

---

## 📦 インストール

### パッケージマネージャでインストール（推奨）

```bash
hajimu パッケージ 追加 ReoShiozawa/hajimu-discord
```

### ソースからビルド

```bash
git clone https://github.com/ReoShiozawa/hajimu-discord.git
cd hajimu-discord
make
make install    # → ~/.hajimu/plugins/hajimu_discord/ にインストール
```

> **ビルド要件:** C コンパイラ, libcurl, OpenSSL, zlib, pthread  
> **macOS:** `brew install openssl curl`  
> **Ubuntu:** `sudo apt install libcurl4-openssl-dev libssl-dev zlib1g-dev`

### 手動配置

`hajimu_discord.hjp` と `hajimu.json` を以下にコピー:

```
~/.hajimu/plugins/hajimu_discord/    ← グローバル
./hajimu_packages/hajimu_discord/    ← プロジェクトローカル
```

---

## 🚀 クイックスタート

### 1. Discord Developer Portal で Bot を作成

1. [Discord Developer Portal](https://discord.com/developers/applications) にアクセス
2. 「New Application」→ 名前を入力 → 作成
3. 左メニュー「Bot」→ 「Reset Token」→ **トークンをコピー**
4. 「Privileged Gateway Intents」で **Message Content Intent** を ON
5. 左メニュー「OAuth2」→ 「URL Generator」で `bot` + `applications.commands` を選択
6. 権限を選んで生成された URL でサーバーに招待

### 2. Bot ファイルを作成

`my_bot.jp` というファイルを作成:

```
取り込む "hajimu_discord" として ボット

ボット.ボット作成("ここにトークンを貼り付け")

ボット.メッセージ受信時(関数(メッセージ)
    もし メッセージ["著者"]["ボット"] == 真 なら
        返す
    終わり

    もし メッセージ["内容"] == "!hello" なら
        ボット.返信(メッセージ, "こんにちは！👋")
    終わり
終わり)

ボット.準備完了時(関数(名前)
    表示("✅ " + 名前 + " がオンラインになりました！")
終わり)

ボット.ボット起動()
```

### 3. 実行

```bash
hajimu my_bot.jp
```

Discord でサーバーに `!hello` と送ると、Bot が「こんにちは！👋」と返します 🎉

---

## 📖 チュートリアル

### Step 1: 最小の Bot

```
取り込む "hajimu_discord" として ボット

ボット.ボット作成("YOUR_TOKEN")
ボット.メッセージ受信時(関数(メッセージ)
    もし メッセージ["内容"] == "!ping" なら
        ボット.返信(メッセージ, "🏓 ポン！")
    終わり
終わり)
ボット.ボット起動()
```

### Step 2: 複数のコマンド

```
ボット.メッセージ受信時(関数(メッセージ)
    変数 著者 = メッセージ["著者"]
    もし 著者["ボット"] == 真 なら 返す 終わり

    変数 内容 = メッセージ["内容"]
    変数 チャンネル = メッセージ["チャンネルID"]

    もし 内容 == "!ping" なら
        ボット.返信(メッセージ, "🏓 ポン！")
    終わり

    もし 内容 == "!hello" なら
        ボット.返信(メッセージ, "こんにちは、" + 著者["ユーザー名"] + " さん！")
    終わり

    もし 内容 == "!time" なら
        ボット.メッセージ送信(チャンネル, "現在の時刻は... まだ実装してません 😅")
    終わり
終わり)
```

### Step 3: リッチな埋め込み (Embed)

```
変数 e = ボット.埋め込み作成()
ボット.埋め込みタイトル(e, "📘 お知らせ")
ボット.埋め込み説明(e, "新機能がリリースされました！")
ボット.埋め込み色(e, 0x5865F2)
ボット.埋め込みフィールド(e, "バージョン", "1.0.0", 真)
ボット.埋め込みフィールド(e, "変更点", "色々追加しました", 真)
ボット.埋め込みフッター(e, "はじむ Bot")
ボット.埋め込みタイムスタンプ(e)
ボット.埋め込み送信(チャンネルID, e)
```

### Step 4: スラッシュコマンド

```
// /greet コマンドを登録（Bot起動前に記述）
変数 cmd = ボット.コマンド登録("greet", "挨拶する", 関数(インタラクション)
    ボット.コマンド応答(インタラクション, "👋 こんにちは！")
終わり)

// オプション追加（省略可能な引数）
ボット.コマンドオプション(cmd, "文字列", "message", "カスタムメッセージ", 偽)
```

### Step 5: ステータス設定

```
ボット.準備完了時(関数(名前)
    ボット.ステータス設定("オンライン", "はじむ言語で動作中", "プレイ中")
終わり)
```

ステータスの種類:
| 日本語 | 英語 | 表示例 |
|---|---|---|
| `"プレイ中"` | PLAYING | ○○をプレイ中 |
| `"配信中"` | STREAMING | ○○を配信中 |
| `"再生中"` | LISTENING | ○○を再生中 |
| `"視聴中"` | WATCHING | ○○を視聴中 |
| `"競争中"` | COMPETING | ○○に参戦中 |

### Step 6: モデレーション

```
// キック
ボット.キック(サーバーID, ユーザーID)

// BAN
ボット.BAN(サーバーID, ユーザーID, "規約違反")

// BAN解除
ボット.BAN解除(サーバーID, ユーザーID)

// ロール付与
ボット.ロール付与(サーバーID, ユーザーID, ロールID)
```

### Step 7: DM (ダイレクトメッセージ)

```
// DMチャンネルを作成
変数 dm = ボット.DM作成(ユーザーID)
// 送信
ボット.メッセージ送信(dm["ID"], "こっそりメッセージ 🤫")
```

---

## 📚 API リファレンス

### ボット管理

| 関数 | 引数 | 説明 |
|---|---|---|
| `ボット作成(トークン)` | 文字列 | Bot を初期化 |
| `ボット起動()` | — | Gateway に接続してイベントループ開始 |
| `ボット停止()` | — | Bot を停止 |
| `インテント設定(...)` | 文字列/数値(可変長) | Gateway Intents を設定 |
| `バージョン()` | — | プラグインバージョンを返す |

### イベント

| 関数 | 引数 | 説明 |
|---|---|---|
| `イベント(名前, コールバック)` | 文字列, 関数 | 任意のイベントを登録 |
| `準備完了時(コールバック)` | 関数 | Bot 接続完了時 |
| `メッセージ受信時(コールバック)` | 関数 | メッセージ受信時 |
| `コマンド受信時(コールバック)` | 関数 | スラッシュコマンド受信時 |
| `参加時(コールバック)` | 関数 | メンバー参加時 |
| `退出時(コールバック)` | 関数 | メンバー退出時 |
| `リアクション時(コールバック)` | 関数 | リアクション追加時 |

### メッセージ

| 関数 | 引数 | 説明 |
|---|---|---|
| `メッセージ送信(チャンネルID, 内容)` | 文字列, 文字列 | メッセージを送信 |
| `返信(メッセージ, 内容)` | 辞書, 文字列 | メッセージに返信 |
| `メッセージ編集(チャンネルID, メッセージID, 内容)` | 文字列×3 | メッセージを編集 |
| `メッセージ削除(チャンネルID, メッセージID)` | 文字列×2 | メッセージを削除 |
| `一括削除(チャンネルID, ID配列)` | 文字列, 配列 | メッセージを一括削除 |
| `ピン留め(チャンネルID, メッセージID)` | 文字列×2 | メッセージをピン留め |

### 埋め込み (Embed)

| 関数 | 引数 | 説明 |
|---|---|---|
| `埋め込み作成()` | — | 新しい埋め込みを作成 |
| `埋め込みタイトル(e, テキスト)` | 数値, 文字列 | タイトルを設定 |
| `埋め込み説明(e, テキスト)` | 数値, 文字列 | 説明を設定 |
| `埋め込み色(e, 色)` | 数値, 数値 | 色を設定 (0xRRGGBB) |
| `埋め込みフィールド(e, 名前, 値[, インライン])` | 数値, 文字列, 文字列[, 真偽] | フィールドを追加 |
| `埋め込みフッター(e, テキスト[, アイコンURL])` | 数値, 文字列[, 文字列] | フッターを設定 |
| `埋め込みサムネイル(e, URL)` | 数値, 文字列 | サムネイルを設定 |
| `埋め込み画像(e, URL)` | 数値, 文字列 | 画像を設定 |
| `埋め込み著者(e, 名前[, アイコン, URL])` | 数値, 文字列[, 文字列, 文字列] | 著者を設定 |
| `埋め込みタイムスタンプ(e)` | 数値 | 現在時刻を設定 |
| `埋め込み送信(チャンネルID, e[, テキスト])` | 文字列, 数値[, 文字列] | 埋め込みを送信 |

### スラッシュコマンド

| 関数 | 引数 | 説明 |
|---|---|---|
| `コマンド登録(名前, 説明, コールバック)` | 文字列, 文字列, 関数 | コマンドを登録 |
| `コマンドオプション(ID, 型, 名前, 説明[, 必須])` | 数値, 文字列, 文字列, 文字列[, 真偽] | オプションを追加 |
| `コマンド応答(インタラクション, 内容)` | 辞書, 文字列 | コマンドに応答 |
| `コマンド遅延応答(インタラクション)` | 辞書 | 「考え中...」表示 |
| `コマンドフォローアップ(インタラクション, 内容)` | 辞書, 文字列 | 遅延後にフォローアップ |

**オプションの型:**

| 日本語 | 英語 | Discord Type |
|---|---|---|
| `"文字列"` | STRING | 3 |
| `"整数"` | INTEGER | 4 |
| `"真偽値"` | BOOLEAN | 5 |
| `"ユーザー"` | USER | 6 |
| `"チャンネル"` | CHANNEL | 7 |
| `"ロール"` | ROLE | 8 |
| `"数値"` | NUMBER | 10 |

### チャンネル・サーバー

| 関数 | 引数 | 説明 |
|---|---|---|
| `チャンネル情報(ID)` | 文字列 | チャンネル情報を取得 |
| `チャンネル一覧(サーバーID)` | 文字列 | チャンネル一覧を取得 |
| `タイピング表示(チャンネルID)` | 文字列 | 「入力中...」を表示 |
| `サーバー情報(ID)` | 文字列 | サーバー情報を取得 |
| `メンバー情報(サーバーID, ユーザーID)` | 文字列×2 | メンバー情報を取得 |

### モデレーション

| 関数 | 引数 | 説明 |
|---|---|---|
| `キック(サーバーID, ユーザーID[, 理由])` | 文字列×2-3 | メンバーをキック |
| `BAN(サーバーID, ユーザーID[, 理由])` | 文字列×2-3 | メンバーをBAN |
| `BAN解除(サーバーID, ユーザーID)` | 文字列×2 | BANを解除 |
| `ロール付与(サーバーID, ユーザーID, ロールID)` | 文字列×3 | ロールを付与 |
| `ロール剥奪(サーバーID, ユーザーID, ロールID)` | 文字列×3 | ロールを剥奪 |
| `ロール一覧(サーバーID)` | 文字列 | ロール一覧を取得 |

### リアクション・ステータス・ユーザー

| 関数 | 引数 | 説明 |
|---|---|---|
| `リアクション追加(チャンネルID, メッセージID, 絵文字)` | 文字列×3 | リアクションを追加 |
| `リアクション削除(チャンネルID, メッセージID, 絵文字)` | 文字列×3 | リアクションを削除 |
| `ステータス設定(状態[, テキスト, 種類])` | 文字列×1-3 | Botステータスを設定 |
| `自分情報()` | — | Bot自身の情報を取得 |
| `ユーザー情報(ID)` | 文字列 | ユーザー情報を取得 |
| `DM作成(ユーザーID)` | 文字列 | DMチャンネルを作成 |

---

## 📡 イベント一覧

`イベント(名前, コールバック)` で登録可能なイベント名:

| 日本語 | Discord Event | 説明 |
|---|---|---|
| `"メッセージ受信"` | MESSAGE_CREATE | メッセージ受信 |
| `"メッセージ編集"` | MESSAGE_UPDATE | メッセージ編集 |
| `"メッセージ削除イベント"` | MESSAGE_DELETE | メッセージ削除 |
| `"メンバー参加"` | GUILD_MEMBER_ADD | メンバー参加 |
| `"メンバー退出"` | GUILD_MEMBER_REMOVE | メンバー退出 |
| `"リアクション追加"` | MESSAGE_REACTION_ADD | リアクション追加 |
| `"リアクション削除"` | MESSAGE_REACTION_REMOVE | リアクション削除 |
| `"サーバー参加"` | GUILD_CREATE | サーバーに参加 |
| `"サーバー退出"` | GUILD_DELETE | サーバーから退出 |
| `"チャンネル作成"` | CHANNEL_CREATE | チャンネル作成 |
| `"チャンネル削除"` | CHANNEL_DELETE | チャンネル削除 |
| `"入力中"` | TYPING_START | 入力中 |
| `"プレゼンス更新"` | PRESENCE_UPDATE | プレゼンス更新 |
| `"ボイス状態更新"` | VOICE_STATE_UPDATE | ボイス状態変更 |
| `"準備完了"` | READY | Bot接続完了 |
| `"再接続完了"` | RESUMED | セッション再開完了 |

> 英語のイベント名 (`MESSAGE_CREATE` 等) もそのまま使用できます。

---

## メッセージオブジェクトの構造

`メッセージ受信時` のコールバックに渡される辞書のキー:

```
{
  "ID": "1234567890...",
  "内容": "こんにちは",
  "チャンネルID": "1234567890...",
  "サーバーID": "1234567890...",
  "著者": {
    "ID": "1234567890...",
    "ユーザー名": "username",
    "表示名": "表示名",
    "アバター": "hash",
    "ボット": false
  },
  "タイムスタンプ": "2026-02-12T00:00:00.000Z",
  "メンション": [...],
  "埋め込み": [...],
  "添付ファイル": [...],
  "返信元": { ... } or null
}
```

> Discord API のキーは自動的に日本語に変換されます。

---

## 🧑‍🍳 レシピ集

### エコー Bot

```
ボット.メッセージ受信時(関数(m)
    もし m["著者"]["ボット"] != 真 なら
        ボット.返信(m, "あなた: " + m["内容"])
    終わり
終わり)
```

### ウェルカムメッセージ

```
変数 歓迎チャンネル = "1234567890123456789" // チャンネルID

ボット.参加時(関数(メンバー)
    変数 名前 = メンバー["ユーザー"]["ユーザー名"]
    変数 e = ボット.埋め込み作成()
    ボット.埋め込みタイトル(e, "🎉 ようこそ！")
    ボット.埋め込み説明(e, 名前 + " さん、サーバーへようこそ！")
    ボット.埋め込み色(e, 0x57F287)
    ボット.埋め込み送信(歓迎チャンネル, e)
終わり)
```

### 投票機能

```
もし 内容 == "!vote" なら
    変数 結果 = ボット.メッセージ送信(チャンネル, "📊 今日のランチは？")
    もし 結果 != 偽 なら
        ボット.リアクション追加(チャンネル, 結果["ID"], "🍜")
        ボット.リアクション追加(チャンネル, 結果["ID"], "🍕")
        ボット.リアクション追加(チャンネル, 結果["ID"], "🍔")
    終わり
終わり
```

### 遅延応答（重い処理）

```
ボット.コマンド登録("analyze", "データを分析する", 関数(インタラクション)
    // まず「考え中...」を表示
    ボット.コマンド遅延応答(インタラクション)

    // 重い処理をここで実行...

    // 結果を送信
    ボット.コマンドフォローアップ(インタラクション, "分析完了！結果: ...")
終わり)
```

---

## ❓ FAQ

<details>
<summary><strong>Q: トークンはどこで取得できますか？</strong></summary>

[Discord Developer Portal](https://discord.com/developers/applications) → アプリケーション選択 → 左メニュー「Bot」→ 「Reset Token」でトークンをコピーできます。

⚠️ **トークンは絶対にコードに直接書かず、環境変数で管理することを推奨します。**
</details>

<details>
<summary><strong>Q: Message Content Intent を有効にする必要がありますか？</strong></summary>

はい。`メッセージ["内容"]` を読み取るには、Developer Portal の Bot 設定で **Message Content Intent** を ON にしてください。スラッシュコマンドのみ使用する場合は不要です。
</details>

<details>
<summary><strong>Q: スラッシュコマンドが表示されません</strong></summary>

スラッシュコマンドは Bot 起動時に Discord API に登録されます。反映まで **最大1時間** かかる場合があります。開発中はギルドコマンドの使用を検討してください。
</details>

<details>
<summary><strong>Q: Bot が切断されます</strong></summary>

hajimu_discord は自動再接続をサポートしています。Gateway の切断時は自動的に Resume/Reconnect を行います。ログレベルをデバッグに設定して詳細を確認できます:

```
ボット.ログレベル設定("デバッグ")
```
</details>

<details>
<summary><strong>Q: ボイスチャンネルには対応していますか？</strong></summary>

v1.0.0 では未対応です。v2.0 で対応予定です。
</details>

<details>
<summary><strong>Q: レート制限は処理されますか？</strong></summary>

はい。REST API で 429 (Rate Limited) が返された場合、自動的に `retry_after` 秒待機してリトライします。
</details>

---

## インテント設定

```
// 文字列で指定
ボット.インテント設定("デフォルト")
ボット.インテント設定("メッセージ", "メッセージ内容", "リアクション")
ボット.インテント設定("全て") // ⚠️ 特権インテント含む

// 数値でも OK
ボット.インテント設定(32767)
```

| 名前 | 値 | 特権？ |
|---|---|---|
| `"サーバー"` | 1 | いいえ |
| `"メンバー"` | 2 | **はい** |
| `"モデレーション"` | 4 | いいえ |
| `"メッセージ"` | 512 | いいえ |
| `"メッセージ内容"` | 32768 | **はい** |
| `"リアクション"` | 1024 | いいえ |
| `"DM"` | 4096 | いいえ |
| `"プレゼンス"` | 256 | **はい** |
| `"ボイス"` | 128 | いいえ |
| `"デフォルト"` | 33280 | いいえ |
| `"全て"` | 262143 | **はい** |

> **特権インテント** は Developer Portal で有効にする必要があります。

---

## 📜 変更履歴

### v1.0.0 (2026-02-12)

🎉 **初回リリース**

- Discord Gateway API v10 対応 (WebSocket + zlib-stream)
- Discord REST API v10 対応 (libcurl)
- 自動再接続 (Resume/Reconnect)
- 自動レート制限処理
- 完全日本語 API (55関数)
- イベントシステム (16種の日本語イベント名)
- 埋め込み (Embed) ビルダー
- スラッシュコマンド登録・応答
- モデレーション (キック/BAN/ロール管理)
- リアクション追加・削除
- DM 送信
- ステータス/プレゼンス設定

### ロードマップ

- **v1.1** — ファイル添付、メッセージコンポーネント (ボタン/セレクトメニュー)
- **v1.2** — ギルドコマンド、自動分割メッセージ (2000文字超)
- **v2.0** — ボイスチャンネル対応 (Opus/Sodium)

---

## 📄 ライセンス

MIT License — 詳細は [LICENSE](LICENSE) を参照

---

<p align="center">
  <sub>はじむ言語で Discord Bot を作ろう 🤖</sub>
</p>
