<p align="center">
  <img src="https://img.shields.io/badge/言語-はじむ-ff6b6b?style=for-the-badge" alt="はじむ">
  <img src="https://img.shields.io/badge/Discord_API-v10-5865F2?style=for-the-badge&logo=discord&logoColor=white" alt="Discord API v10">
  <img src="https://img.shields.io/badge/license-MIT-green?style=for-the-badge" alt="MIT License">
  <img src="https://img.shields.io/badge/version-2.2.0-blue?style=for-the-badge" alt="v2.2.0">
</p>

# hajimu_discord — はじむ言語用 Discord Bot 開発プラグイン

**完全日本語 API で Discord Bot を開発。** discord.js や discord.py のように、はじむ言語でも直感的に Bot が書けます。

```
取り込む "hajimu_discord" として ボット

ボット.ボット作成("YOUR_TOKEN")
ボット.メッセージ受信時(関数(メッセージ)
    もし メッセージ["内容"] == "!ping" なら
        ボット.返信(メッセージ, "🏓 ポン！")
    終わり
終わり)
ボット.ボット起動()
```

**たった 8 行で動く Discord Bot。** 英語を一切知らなくても大丈夫です。

**v1.7.0:** 監査ログ / AutoModeration / 絵文字管理 / スケジュールイベント / 投票 対応！

---

## 他フレームワークとの比較

| 機能 | hajimu_discord | discord.js | discord.py |
|---|---|---|---|
| 言語 | はじむ (日本語) | JavaScript | Python |
| Gateway | v10 ✅ | v10 | v10 |
| REST API | v10 ✅ | v10 | v10 |
| スラッシュコマンド | ✅ | ✅ | ✅ |
| 埋め込み (Embed) | ✅ | ✅ | ✅ |
| ボタン / セレクトメニュー | ✅ | ✅ | ✅ |
| モーダル | ✅ | ✅ | ✅ |
| サブコマンド | ✅ | ✅ | ✅ |
| コンテキストメニュー | ✅ | ✅ | ✅ |
| チャンネル / スレッド管理 | ✅ | ✅ | ✅ |
| Webhook | ✅ | ✅ | ✅ |
| ファイル添付 | ✅ | ✅ | ✅ |
| コレクター | ✅ | ✅ | ✅ |
| ボイスチャンネル | ✅ | ✅ | ✅ |
| ステージチャンネル | ✅ | ✅ | ✅ |
| スタンプ管理 | ✅ | ✅ | ✅ |
| フォーラムチャンネル | ✅ | ✅ | ✅ |
| Markdownユーティリティ | ✅ | ✅ | ✅ |
| Components V2 | ✅ | ✅ | ✅ |
| サーバーテンプレート | ✅ | ✅ | ✅ |
| オンボーディング | ✅ | ✅ | ✅ |
| サウンドボード | ✅ | ✅ | ✅ |
| OAuth2 | ✅ | ✅ | ✅ |
| シャーディング | ✅ | ✅ | ✅ |
| 外部依存 | libcurl + OpenSSL | Node.js | Python 3.8+ |
| API言語 | **完全日本語** | 英語 | 英語 |

---

## 📑 目次

- [インストール](#-インストール)
- [クイックスタート](#-クイックスタート)
- [チュートリアル](#-チュートリアル)
- [API リファレンス](#-api-リファレンス)
- [イベント一覧](#-イベント一覧)
- [レシピ集](#-レシピ集)
- [FAQ](#-faq)
- [変更履歴](#-変更履歴)

---

## 📦 インストール

### パッケージマネージャでインストール（推奨）

```bash
hajimu パッケージ 追加 ReoShiozawa/hajimu-discord
```

### ソースからビルド

```bash
git clone https://github.com/ReoShiozawa/hajimu-discord.git
cd hajimu-discord
make
make install    # → ~/.hajimu/plugins/hajimu_discord/ にインストール
```

> **ビルド要件:** C コンパイラ, libcurl, OpenSSL, zlib, pthread  
> **macOS:** `brew install openssl curl`  
> **Ubuntu:** `sudo apt install libcurl4-openssl-dev libssl-dev zlib1g-dev`

### 手動配置

`hajimu_discord.hjp` と `hajimu.json` を以下にコピー:

```
~/.hajimu/plugins/hajimu_discord/    ← グローバル
./hajimu_packages/hajimu_discord/    ← プロジェクトローカル
```

---

## 🚀 クイックスタート

### 1. Discord Developer Portal で Bot を作成

1. [Discord Developer Portal](https://discord.com/developers/applications) にアクセス
2. 「New Application」→ 名前を入力 → 作成
3. 左メニュー「Bot」→ 「Reset Token」→ **トークンをコピー**
4. 「Privileged Gateway Intents」で **Message Content Intent** を ON
5. 左メニュー「OAuth2」→ 「URL Generator」で `bot` + `applications.commands` を選択
6. 権限を選んで生成された URL でサーバーに招待

### 2. Bot ファイルを作成

`my_bot.jp` というファイルを作成:

```
取り込む "hajimu_discord" として ボット

ボット.ボット作成("ここにトークンを貼り付け")

ボット.メッセージ受信時(関数(メッセージ)
    もし メッセージ["著者"]["ボット"] == 真 なら
        返す
    終わり

    もし メッセージ["内容"] == "!hello" なら
        ボット.返信(メッセージ, "こんにちは！👋")
    終わり
終わり)

ボット.準備完了時(関数(名前)
    表示("✅ " + 名前 + " がオンラインになりました！")
終わり)

ボット.ボット起動()
```

### 3. 実行

```bash
hajimu my_bot.jp
```

Discord でサーバーに `!hello` と送ると、Bot が「こんにちは！👋」と返します 🎉

---

## 📖 チュートリアル

### Step 1: 最小の Bot

```
取り込む "hajimu_discord" として ボット

ボット.ボット作成("YOUR_TOKEN")
ボット.メッセージ受信時(関数(メッセージ)
    もし メッセージ["内容"] == "!ping" なら
        ボット.返信(メッセージ, "🏓 ポン！")
    終わり
終わり)
ボット.ボット起動()
```

### Step 2: 複数のコマンド

```
ボット.メッセージ受信時(関数(メッセージ)
    変数 著者 = メッセージ["著者"]
    もし 著者["ボット"] == 真 なら 返す 終わり

    変数 内容 = メッセージ["内容"]
    変数 チャンネル = メッセージ["チャンネルID"]

    もし 内容 == "!ping" なら
        ボット.返信(メッセージ, "🏓 ポン！")
    終わり

    もし 内容 == "!hello" なら
        ボット.返信(メッセージ, "こんにちは、" + 著者["ユーザー名"] + " さん！")
    終わり

    もし 内容 == "!time" なら
        ボット.メッセージ送信(チャンネル, "現在の時刻は... まだ実装してません 😅")
    終わり
終わり)
```

### Step 3: リッチな埋め込み (Embed)

```
変数 e = ボット.埋め込み作成()
ボット.埋め込みタイトル(e, "📘 お知らせ")
ボット.埋め込み説明(e, "新機能がリリースされました！")
ボット.埋め込み色(e, 0x5865F2)
ボット.埋め込みフィールド(e, "バージョン", "1.0.0", 真)
ボット.埋め込みフィールド(e, "変更点", "色々追加しました", 真)
ボット.埋め込みフッター(e, "はじむ Bot")
ボット.埋め込みタイムスタンプ(e)
ボット.埋め込み送信(チャンネルID, e)
```

### Step 4: スラッシュコマンド

```
// /greet コマンドを登録（Bot起動前に記述）
変数 cmd = ボット.コマンド登録("greet", "挨拶する", 関数(インタラクション)
    ボット.コマンド応答(インタラクション, "👋 こんにちは！")
終わり)

// オプション追加（省略可能な引数）
ボット.コマンドオプション(cmd, "文字列", "message", "カスタムメッセージ", 偽)
```

### Step 5: ステータス設定

```
ボット.準備完了時(関数(名前)
    ボット.ステータス設定("オンライン", "はじむ言語で動作中", "プレイ中")
終わり)
```

ステータスの種類:
| 日本語 | 英語 | 表示例 |
|---|---|---|
| `"プレイ中"` | PLAYING | ○○をプレイ中 |
| `"配信中"` | STREAMING | ○○を配信中 |
| `"再生中"` | LISTENING | ○○を再生中 |
| `"視聴中"` | WATCHING | ○○を視聴中 |
| `"競争中"` | COMPETING | ○○に参戦中 |

### Step 6: モデレーション

```
// キック
ボット.キック(サーバーID, ユーザーID)

// BAN
ボット.BAN(サーバーID, ユーザーID, "規約違反")

// BAN解除
ボット.BAN解除(サーバーID, ユーザーID)

// ロール付与
ボット.ロール付与(サーバーID, ユーザーID, ロールID)
```

### Step 7: DM (ダイレクトメッセージ)

```
// DMチャンネルを作成
変数 dm = ボット.DM作成(ユーザーID)
// 送信
ボット.メッセージ送信(dm["ID"], "こっそりメッセージ 🤫")
```

### Step 8: ボタン付きメッセージ <sup>v1.2</sup>

```
// ボタンを作成
変数 はい = ボット.ボタン作成("はい ✅", "サクセス", "btn_yes")
変数 いいえ = ボット.ボタン作成("いいえ ❌", "デンジャー", "btn_no")

// アクション行にまとめる
変数 行 = ボット.アクション行作成()
ボット.行にボタン追加(行, はい)
ボット.行にボタン追加(行, いいえ)

// 送信
ボット.コンポーネント送信(チャンネルID, "参加しますか？", [行])

// ボタンクリック時の処理
ボット.ボタン時("btn_yes", 関数(インタラクション)
    ボット.インタラクション更新(インタラクション, "✅ 参加登録しました！")
終わり)

ボット.ボタン時("btn_no", 関数(インタラクション)
    ボット.インタラクション更新(インタラクション, "❌ キャンセルしました")
終わり)
```

### Step 9: モーダル（フォーム） <sup>v1.3</sup>

```
// スラッシュコマンドからモーダルを表示
ボット.コマンド登録("feedback", "フィードバックを送る", 関数(インタラクション)
    変数 m = ボット.モーダル作成("fb_modal", "📝 フィードバック")
    ボット.テキスト入力追加(m, "タイトル", "fb_title", 1)
    ボット.テキスト入力追加(m, "内容", "fb_body", 2)
    ボット.モーダル表示(インタラクション, m)
終わり)

// モーダル送信時
ボット.モーダル送信時("fb_modal", 関数(インタラクション)
    変数 タイトル = インタラクション["データ"]["fb_title"]
    変数 内容 = インタラクション["データ"]["fb_body"]
    ボット.コマンド応答(インタラクション, "📬 受け取りました: " + タイトル, 真)
終わり)
```

### Step 10: サブコマンド <sup>v1.3</sup>

```
// /music play, /music stop のようなサブコマンド
ボット.コマンド登録("music", "音楽コマンド", 偽)

ボット.サブコマンド追加("music", "play", "再生する", 関数(インタラクション)
    ボット.コマンド応答(インタラクション, "🎵 再生開始！")
終わり)

ボット.サブコマンド追加("music", "stop", "停止する", 関数(インタラクション)
    ボット.コマンド応答(インタラクション, "⏹ 停止しました")
終わり)
```

### Step 11: チャンネル & スレッド管理 <sup>v1.4</sup>

```
// チャンネル作成（テキスト / ボイス / カテゴリ / ニュース / ステージ / フォーラム）
ボット.チャンネル作成(サーバーID, "一般チャット", "テキスト")
ボット.チャンネル作成(サーバーID, "雑談", "ボイス")

// カテゴリ配下にチャンネル作成
変数 カテゴリ = ボット.チャンネル作成(サーバーID, "プロジェクト", "カテゴリ")
ボット.チャンネル作成(サーバーID, "ログ", "テキスト", カテゴリ["ID"])

// チャンネル編集
ボット.チャンネル編集(チャンネルID, {"名前": "新名前", "トピック": "新しいトピック"})

// スレッド作成 & 参加
ボット.スレッド作成(チャンネルID, "質問スレッド")
ボット.スレッド参加(スレッドID)
ボット.スレッドメンバー追加(スレッドID, ユーザーID)

// 権限設定（チャンネル単位）
ボット.権限設定(チャンネルID, ロールID, 許可ビット, 拒否ビット)

// 招待
変数 招待 = ボット.招待作成(チャンネルID, {"有効期限": 86400, "最大使用回数": 10})
表示(招待["code"])
```

### Step 12: Webhook & ファイル添付 <sup>v1.5</sup>

```
// Webhook 作成
変数 wh = ボット.Webhook作成(チャンネルID, "通知Bot")

// Webhook 送信（カスタム名・アバター付き）
ボット.Webhook送信(WebhookURL, "GitHub から通知が届きました", "GitHub Bot", "https://...")

// ファイル添付送信
ボット.ファイル送信(チャンネルID, "/path/to/image.png", "スクリーンショットです")
```

### Step 13: コレクター <sup>v1.6</sup>

```
// メッセージ収集（30秒、最大5件）
変数 収集結果 = ボット.メッセージ収集(チャンネルID, 偽, 30, 5)
表示("収集したメッセージ数: " + 長さ(収集結果))

// リアクション収集（60秒間）
変数 リアクション = ボット.リアクション収集(チャンネルID, メッセージID, 60, 10)

// メンバー一覧 & 検索
変数 メンバーリスト = ボット.メンバー一覧(サーバーID, 100)
変数 結果 = ボット.メンバー検索(サーバーID, "taro")

// サーバー一覧
変数 サーバーリスト = ボット.サーバー一覧()
```

### Step 14: AutoModeration <sup>v1.7</sup>

```
// キーワードフィルタルールを作成
ボット.AutoModルール作成(サーバーID, {
    "名前": "NGワードフィルタ",
    "トリガー種類": 1,
    "キーワード": ["spam", "scam", "hack"],
    "アクション種類": 1,
    "有効": 真
})

// AutoMod発動時の処理
ボット.AutoMod実行時(関数(データ)
    表示("⚠️ AutoMod発動: " + データ["一致キーワード"])
終わり)
```

### Step 15: 絵文字 & 投票 <sup>v1.7</sup>

```
// カスタム絵文字を作成
ボット.絵文字作成(サーバーID, "happy", "/path/to/happy.png")

// 投票を作成（24時間、複数選択可）
ボット.投票作成(チャンネルID, "好きなプログラミング言語は？",
    ["はじむ", "Python", "JavaScript", "Rust"], 24, 真)
```

### Step 16: ボイスチャンネル <sup>v2.0</sup>

```
// ボイスチャンネルに参加して音声を再生
ボット.VC接続(サーバーID, ボイスチャンネルID)

// 接続完了イベントを待って再生開始
ボット.イベント("ボイス接続完了", 関数(ギルドID):
    ボット.音声再生(ギルドID, "/path/to/music.mp3")
)

// 音声制御
ボット.音声一時停止(サーバーID)   // 一時停止
ボット.音声再開(サーバーID)       // 再開
ボット.音声スキップ(サーバーID)   // スキップ
ボット.音声ループ(サーバーID, 真) // ループ有効
ボット.VC切断(サーバーID)         // 退出
```

### Step 17: ステージチャンネル <sup>v2.1</sup>

```
// ステージチャンネルでイベントを開催
ボット.ステージ開始(ステージチャンネルID, "🎤 はじむ言語勉強会")

// トピック変更
ボット.ステージ編集(ステージチャンネルID, "🎤 Q&Aタイム")

// 終了
ボット.ステージ終了(ステージチャンネルID)
```

### Step 18: Markdownユーティリティ <sup>v2.1</sup>

```
// Discordメッセージをリッチに装飾
変数 テキスト = ボット.太字("重要") + "な" + ボット.斜体("お知らせ")
ボット.送信(チャンネルID, テキスト)  // **重要**な*お知らせ*

// タイムスタンプ付きメッセージ
変数 期限 = ボット.タイムスタンプ(1735689600, "R")   // 相対時間
ボット.送信(チャンネルID, "締切: " + 期限)

// コードブロック
ボット.送信(チャンネルID, ボット.コードブロック("表示 \"hello\"", "はじむ"))

// メンション
変数 msg = ボット.ユーザーメンション(ユーザーID) + " さん、" + ボット.チャンネルメンション(雑談ID) + " を確認してください"
```

### Step 19: Components V2 <sup>v2.2</sup>

```
// Components V2 でリッチなレイアウトメッセージを送信
変数 テキスト = ボット.テキスト表示(1, "📢 お知らせ")
変数 区切り = ボット.セパレーター(2, 真, 真)
変数 本文 = ボット.テキスト表示(3, "新バージョンがリリースされました！")
変数 画像 = ボット.メディアアイテム("https://example.com/banner.png", "バナー")
変数 ギャラリー = ボット.メディアギャラリー(4, [画像])
変数 コンテナ = ボット.コンテナ(5, [テキスト, 区切り, 本文, ギャラリー], 0x5865F2)
ボット.V2メッセージ送信(チャンネルID, [コンテナ])
```

### Step 20: シャーディング <sup>v2.2</sup>

```
// 大規模Bot向けシャーディング設定
変数 情報 = ボット.シャード情報()   // 推奨シャード数を取得
表示(情報["shards"])                // 例: 4

// シャードID 0 として起動（4シャード中）
ボット.シャード設定(0, 4)
ボット.ボット作成("TOKEN")
ボット.ボット起動()

// サーバーの所属シャードを計算
変数 shard = ボット.シャードID計算("1234567890", 4)
```

---

## 📚 API リファレンス

### ボット管理

| 関数 | 引数 | 説明 |
|---|---|---|
| `ボット作成(トークン)` | 文字列 | Bot を初期化 |
| `ボット起動()` | — | Gateway に接続してイベントループ開始 |
| `ボット停止()` | — | Bot を停止 |
| `インテント設定(...)` | 文字列/数値(可変長) | Gateway Intents を設定 |
| `バージョン()` | — | プラグインバージョンを返す |

### イベント

| 関数 | 引数 | 説明 |
|---|---|---|
| `イベント(名前, コールバック)` | 文字列, 関数 | 任意のイベントを登録 |
| `準備完了時(コールバック)` | 関数 | Bot 接続完了時 |
| `メッセージ受信時(コールバック)` | 関数 | メッセージ受信時 |
| `コマンド受信時(コールバック)` | 関数 | スラッシュコマンド受信時 |
| `参加時(コールバック)` | 関数 | メンバー参加時 |
| `退出時(コールバック)` | 関数 | メンバー退出時 |
| `リアクション時(コールバック)` | 関数 | リアクション追加時 |
| `エラー時(コールバック)` | 関数 | エラー発生時 |
| `切断時(コールバック)` | 関数 | Gateway 切断時 |
| `再接続時(コールバック)` | 関数 | Gateway 再接続時 |

### メッセージ

| 関数 | 引数 | 説明 |
|---|---|---|
| `メッセージ送信(チャンネルID, 内容)` | 文字列, 文字列 | メッセージを送信 |
| `返信(メッセージ, 内容)` | 辞書, 文字列 | メッセージに返信 |
| `メッセージ編集(チャンネルID, メッセージID, 内容)` | 文字列×3 | メッセージを編集（辞書を返す） |
| `メッセージ削除(チャンネルID, メッセージID)` | 文字列×2 | メッセージを削除 |
| `一括削除(チャンネルID, ID配列)` | 文字列, 配列 | メッセージを一括削除 |
| `メッセージ取得(チャンネルID, メッセージID)` | 文字列×2 | メッセージを取得（辞書を返す） |
| `メッセージ履歴(チャンネルID, 件数)` | 文字列, 数値 | 直近N件のメッセージ取得（1-100） |
| `メッセージ一括削除(チャンネルID, 件数)` | 文字列, 数値 | 直近N件を取得して一括削除 |
| `ピン留め(チャンネルID, メッセージID)` | 文字列×2 | メッセージをピン留め |
| `ピン解除(チャンネルID, メッセージID)` | 文字列×2 | ピン留めを解除 |
| `ピン一覧(チャンネルID)` | 文字列 | ピン留めメッセージ一覧を取得 |

### 埋め込み (Embed)

| 関数 | 引数 | 説明 |
|---|---|---|
| `埋め込み作成()` | — | 新しい埋め込みを作成 |
| `埋め込みタイトル(e, テキスト)` | 数値, 文字列 | タイトルを設定 |
| `埋め込み説明(e, テキスト)` | 数値, 文字列 | 説明を設定 |
| `埋め込み色(e, 色)` | 数値, 数値 | 色を設定 (0xRRGGBB) |
| `埋め込みフィールド(e, 名前, 値[, インライン])` | 数値, 文字列, 文字列[, 真偽] | フィールドを追加 |
| `埋め込みフッター(e, テキスト[, アイコンURL])` | 数値, 文字列[, 文字列] | フッターを設定 |
| `埋め込みサムネイル(e, URL)` | 数値, 文字列 | サムネイルを設定 |
| `埋め込み画像(e, URL)` | 数値, 文字列 | 画像を設定 |
| `埋め込み著者(e, 名前[, アイコン, URL])` | 数値, 文字列[, 文字列, 文字列] | 著者を設定 |
| `埋め込みタイムスタンプ(e)` | 数値 | 現在時刻を設定 |
| `埋め込み送信(チャンネルID, e[, テキスト])` | 文字列, 数値[, 文字列] | 埋め込みを送信 |

### スラッシュコマンド

| 関数 | 引数 | 説明 |
|---|---|---|
| `コマンド登録(名前, 説明, コールバック)` | 文字列, 文字列, 関数 | コマンドを登録 |
| `コマンドオプション(ID, 型, 名前, 説明[, 必須])` | 数値, 文字列, 文字列, 文字列[, 真偽] | オプションを追加 |
| `コマンド応答(インタラクション, 内容[, エフェメラル])` | 辞書, 文字列[, 真偽] | コマンドに応答（第3引数=`真` でエフェメラル） |
| `コマンド遅延応答(インタラクション)` | 辞書 | 「考え中...」表示 |
| `コマンドフォローアップ(インタラクション, 内容)` | 辞書, 文字列 | 遅延後にフォローアップ |
| `コマンド選択肢(オプション, 名前, 値)` | 数値, 文字列, 文字列 | オプションに選択肢を追加 |

**オプションの型:**

| 日本語 | 英語 | Discord Type |
|---|---|---|
| `"文字列"` | STRING | 3 |
| `"整数"` | INTEGER | 4 |
| `"真偽値"` | BOOLEAN | 5 |
| `"ユーザー"` | USER | 6 |
| `"チャンネル"` | CHANNEL | 7 |
| `"ロール"` | ROLE | 8 |
| `"数値"` | NUMBER | 10 |

### サブコマンド <sup>v1.3</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `サブコマンド追加(コマンド名, サブ名, 説明, 関数)` | 文字列, 文字列, 文字列, 関数 | サブコマンドを登録 |
| `サブコマンドグループ追加(コマンド名, グループ名, 説明)` | 文字列, 文字列, 文字列 | サブコマンドグループを追加 |

### コンテキストメニュー <sup>v1.3</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `ユーザーメニュー登録(名前, 関数)` | 文字列, 関数 | 右クリック→ユーザーメニュー |
| `メッセージメニュー登録(名前, 関数)` | 文字列, 関数 | 右クリック→メッセージメニュー |

### オートコンプリート <sup>v1.3</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `オートコンプリート時(コマンド名, 関数)` | 文字列, 関数 | オートコンプリートハンドラを登録 |
| `オートコンプリート応答(インタラクション, 選択肢配列)` | 辞書, 配列 | 候補を返す（最大25件） |

### コンポーネント（ボタン・セレクトメニュー） <sup>v1.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `ボタン作成(ラベル, スタイル, カスタムID)` | 文字列, 数値/文字列, 文字列 | ボタンを作成 |
| `リンクボタン作成(ラベル, URL)` | 文字列, 文字列 | リンクボタンを作成 |
| `ボタン無効化(ボタン, 真偽)` | 数値, 真偽 | ボタンの有効/無効を切替 |
| `アクション行作成()` | — | アクション行を作成 |
| `行にボタン追加(行, ボタン)` | 数値, 数値 | 行にボタンを追加 |
| `行にメニュー追加(行, メニュー)` | 数値, 数値 | 行にセレクトメニューを追加 |
| `コンポーネント送信(チャンネルID, テキスト, 行配列)` | 文字列, 文字列, 配列 | コンポーネント付きメッセージ送信 |
| `セレクトメニュー作成(カスタムID, プレースホルダー)` | 文字列, 文字列 | セレクトメニューを作成 |
| `メニュー選択肢(メニュー, ラベル, 値, 説明)` | 数値, 文字列, 文字列, 文字列 | メニューに選択肢を追加 |
| `ボタン時(カスタムID, 関数)` | 文字列, 関数 | ボタンクリック時のハンドラ |
| `セレクト時(カスタムID, 関数)` | 文字列, 関数 | セレクトメニュー選択時のハンドラ |
| `インタラクション更新(インタラクション, 内容)` | 辞書, 文字列 | メッセージを更新して応答 |
| `インタラクション遅延更新(インタラクション)` | 辞書 | 遅延更新応答 |

**ボタンスタイル:**

| 日本語 / 英語 | 値 | 外観 |
|---|---|---|
| `"プライマリ"` / `1` | 1 | 🔵 青 |
| `"セカンダリ"` / `2` | 2 | ⚪ 灰 |
| `"サクセス"` / `3` | 3 | 🟢 緑 |
| `"デンジャー"` / `4` | 4 | 🔴 赤 |
| `"リンク"` / `5` | 5 | 🔗 リンク（URLのみ） |

### モーダル <sup>v1.3</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `モーダル作成(カスタムID, タイトル)` | 文字列, 文字列 | モーダル（フォーム）を作成 |
| `テキスト入力追加(モーダル, ラベル, カスタムID, スタイル)` | 数値, 文字列, 文字列, 数値 | テキスト入力フィールドを追加 |
| `モーダル表示(インタラクション, モーダル)` | 辞書, 数値 | モーダルを表示 |
| `モーダル送信時(カスタムID, 関数)` | 文字列, 関数 | モーダル送信時のハンドラ |

**テキスト入力のスタイル:**

| 値 | 種類 |
|---|---|
| `1` | 短文（1行） |
| `2` | 長文（複数行） |

### チャンネル・サーバー

| 関数 | 引数 | 説明 |
|---|---|---|
| `チャンネル情報(ID)` | 文字列 | チャンネル情報を取得 |
| `チャンネル一覧(サーバーID)` | 文字列 | チャンネル一覧を取得 |
| `タイピング表示(チャンネルID)` | 文字列 | 「入力中...」を表示 |
| `チャンネル作成(サーバーID, 名前, 種類[, 親ID])` | 文字列×3[, 文字列] | チャンネルを作成 |
| `チャンネル編集(チャンネルID, 設定)` | 文字列, 辞書 | チャンネル設定を変更 |
| `チャンネル削除(チャンネルID)` | 文字列 | チャンネルを削除 |
| `サーバー情報(ID)` | 文字列 | サーバー情報を取得 |
| `メンバー情報(サーバーID, ユーザーID)` | 文字列×2 | メンバー情報を取得 |

**チャンネル種類:** `"テキスト"` (0), `"ボイス"` (2), `"カテゴリ"` (4), `"ニュース"` (5), `"ステージ"` (13), `"フォーラム"` (15)

**チャンネル編集の設定キー:**

| キー | 説明 |
|---|---|
| `"名前"` | チャンネル名 |
| `"トピック"` | トピック |
| `"NSFW"` | NSFW設定（真偽） |
| `"位置"` | 表示位置 |
| `"レート制限"` | スローモード(秒) |
| `"親カテゴリ"` | 親カテゴリID |
| `"ビットレート"` | VC ビットレート |
| `"ユーザー上限"` | VC ユーザー上限 |

### スレッド <sup>v1.4</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `スレッド作成(チャンネルID, 名前[, アーカイブ分])` | 文字列, 文字列[, 数値] | スレッドを作成（デフォルト1440分） |
| `スレッド参加(スレッドID)` | 文字列 | スレッドに参加 |
| `スレッド退出(スレッドID)` | 文字列 | スレッドから退出 |
| `スレッドメンバー追加(スレッドID, ユーザーID)` | 文字列×2 | メンバーをスレッドに追加 |
| `スレッドメンバー削除(スレッドID, ユーザーID)` | 文字列×2 | メンバーをスレッドから削除 |

### 権限 <sup>v1.4</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `権限設定(チャンネルID, 対象ID, 許可, 拒否[, 種類])` | 文字列×2, 数値×2[, 数値] | 権限オーバーライド（種類: 0=ロール, 1=メンバー） |

### 招待 <sup>v1.4</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `招待作成(チャンネルID[, 設定])` | 文字列[, 辞書] | 招待を作成 |
| `招待一覧(サーバーID)` | 文字列 | サーバーの招待一覧 |
| `招待削除(招待コード)` | 文字列 | 招待を削除 |
| `招待情報(招待コード)` | 文字列 | 招待情報を取得 |

**招待設定のキー:** `"有効期限"` (max_age秒), `"最大使用回数"` (max_uses), `"一時的"` (temporary)

### Webhook <sup>v1.5</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `Webhook作成(チャンネルID, 名前)` | 文字列×2 | Webhookを作成 |
| `Webhook一覧(チャンネルID)` | 文字列 | チャンネルのWebhook一覧 |
| `Webhook削除(WebhookID)` | 文字列 | Webhookを削除 |
| `Webhook送信(URL, 内容[, 名前, アバターURL])` | 文字列×2[, 文字列×2] | Webhookでメッセージ送信 |

### ファイル添付 <sup>v1.5</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `ファイル送信(チャンネルID, ファイルパス[, コメント])` | 文字列×2[, 文字列] | ファイルを添付して送信 |

### コレクター <sup>v1.6</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `メッセージ収集(チャンネルID, フィルタ, タイムアウト秒[, 最大件数])` | 文字列, 値, 数値[, 数値] | メッセージを収集（ブロッキング） |
| `リアクション収集(チャンネルID, メッセージID, タイムアウト秒[, 最大件数])` | 文字列×2, 数値[, 数値] | リアクションを収集 |
| `インタラクション収集(チャンネルID, メッセージID, タイムアウト秒[, 最大件数])` | 文字列×2, 数値[, 数値] | コンポーネントインタラクションを収集 |

### メンバー・サーバー一覧 <sup>v1.6</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `メンバー一覧(サーバーID[, 件数])` | 文字列[, 数値] | メンバー一覧を取得（最大1000） |
| `メンバー検索(サーバーID, クエリ[, 件数])` | 文字列, 文字列[, 数値] | メンバーをユーザー名で検索 |
| `サーバー一覧()` | — | Botが参加中のサーバー一覧 |

### 監査ログ <sup>v1.7</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `監査ログ(サーバーID[, 種類, 件数])` | 文字列[, 数値, 数値] | 監査ログを取得（最大100件） |

### AutoModeration <sup>v1.7</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `AutoModルール一覧(サーバーID)` | 文字列 | ルール一覧を取得 |
| `AutoModルール取得(サーバーID, ルールID)` | 文字列×2 | ルール詳細を取得 |
| `AutoModルール作成(サーバーID, 設定)` | 文字列, 辞書 | ルールを作成 |
| `AutoModルール編集(サーバーID, ルールID, 設定)` | 文字列×2, 辞書 | ルールを編集 |
| `AutoModルール削除(サーバーID, ルールID)` | 文字列×2 | ルールを削除 |
| `AutoMod実行時(コールバック)` | 関数 | AutoMod実行時イベント |

**AutoModルール作成の設定キー:**

| キー | 説明 |
|---|---|
| `"名前"` | ルール名 |
| `"トリガー種類"` | 1=キーワード, 3=スパム, 4=プリセット, 5=メンション |
| `"キーワード"` | フィルタキーワード配列 |
| `"アクション種類"` | 1=ブロック, 2=アラート送信, 3=タイムアウト |
| `"アラートチャンネル"` | アラート送信先チャンネルID |
| `"タイムアウト秒数"` | タイムアウト秒数 |
| `"有効"` | 有効/無効（真偽） |

### 絵文字 <sup>v1.7</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `絵文字一覧(サーバーID)` | 文字列 | 絵文字一覧を取得 |
| `絵文字作成(サーバーID, 名前, 画像パス)` | 文字列×3 | カスタム絵文字を作成（PNG/GIF/JPEG, max 256KB） |
| `絵文字削除(サーバーID, 絵文字ID)` | 文字列×2 | 絵文字を削除 |

### スケジュールイベント <sup>v1.7</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `イベント作成(サーバーID, 名前, 開始, 終了[, 説明])` | 文字列×4[, 文字列] | スケジュールイベント作成（ISO 8601） |
| `イベント編集(サーバーID, イベントID, 設定)` | 文字列×2, 辞書 | イベントを編集 |
| `イベント削除(サーバーID, イベントID)` | 文字列×2 | イベントを削除 |
| `イベント一覧(サーバーID)` | 文字列 | イベント一覧を取得 |

### 投票 (Poll) <sup>v1.7</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `投票作成(チャンネルID, 質問, 選択肢配列, 時間h[, 複数選択])` | 文字列, 文字列, 配列, 数値[, 真偽] | 投票を作成（1-168時間） |
| `投票終了(チャンネルID, メッセージID)` | 文字列×2 | 投票を即時終了 |

### ボイスチャンネル <sup>v2.0</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `VC接続(サーバーID, チャンネルID)` | 文字列×2 | ボイスチャンネルに参加 |
| `VC切断(サーバーID)` | 文字列 | ボイスチャンネルから退出 |
| `音声再生(サーバーID, ソース)` | 文字列×2 | 音声ファイルを再生（WAV/MP3/OGG等） |
| `音声停止(サーバーID)` | 文字列 | 再生停止＆キュークリア |
| `音声一時停止(サーバーID)` | 文字列 | 再生を一時停止 |
| `音声再開(サーバーID)` | 文字列 | 一時停止から再開 |
| `音声スキップ(サーバーID)` | 文字列 | 現在の曲をスキップ |
| `音声キュー(サーバーID)` | 文字列 | キュー内の曲一覧を取得 |
| `音声ループ(サーバーID, 有効)` | 文字列, 真偽 | ループ再生モード切替 |
| `VC状態(サーバーID)` | 文字列 | 接続状態・再生情報を取得 |
| `音声音量(サーバーID, 音量)` | 文字列, 数値 | 音量調整（1-200%） |

> **依存**: `libopus`, `libsodium`, `ffmpeg`（MP3等の非WAVファイル再生時）

### ステージチャンネル <sup>v2.1</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `ステージ開始(チャンネルID, トピック[, 公開])` | 文字列×2[, 真偽] | ステージインスタンスを作成 |
| `ステージ編集(チャンネルID, トピック)` | 文字列×2 | ステージのトピックを変更 |
| `ステージ終了(チャンネルID)` | 文字列 | ステージインスタンスを終了 |
| `ステージ情報(チャンネルID)` | 文字列 | ステージインスタンス情報を取得 |

### スタンプ管理 <sup>v2.1</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `スタンプ一覧(サーバーID)` | 文字列 | サーバーのスタンプ一覧を取得 |
| `スタンプ取得(サーバーID, スタンプID)` | 文字列×2 | スタンプ詳細を取得 |
| `スタンプ作成(サーバーID, 名前, ファイル[, 説明, タグ])` | 文字列×3-5 | スタンプを作成（マルチパートアップロード） |
| `スタンプ編集(サーバーID, スタンプID, 設定)` | 文字列×3 | スタンプを編集 |
| `スタンプ削除(サーバーID, スタンプID)` | 文字列×2 | スタンプを削除 |

### ウェルカム画面 <sup>v2.1</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `ウェルカム画面取得(サーバーID)` | 文字列 | ウェルカム画面情報を取得 |
| `ウェルカム画面編集(サーバーID, 設定)` | 文字列×2 | ウェルカム画面を編集 |

### サーバー・ロール管理 <sup>v2.1</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `サーバー編集(サーバーID, 設定)` | 文字列×2 | サーバー設定を変更（JSON文字列） |
| `ロール作成(サーバーID, 名前[, 色, 権限])` | 文字列, 文字列[, 数値, 文字列] | 新規ロールを作成 |
| `ロール編集(サーバーID, ロールID, 設定)` | 文字列×3 | ロールを編集 |
| `ロール削除(サーバーID, ロールID)` | 文字列×2 | ロールを削除 |

### フォーラムチャンネル <sup>v2.1</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `フォーラム投稿(チャンネルID, タイトル, 内容[, タグ])` | 文字列×3[, 配列] | フォーラムスレッドを作成 |
| `フォーラムタグ一覧(チャンネルID)` | 文字列 | フォーラムの利用可能タグ一覧 |

### Markdownユーティリティ <sup>v2.1</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `太字(テキスト)` | 文字列 | `**テキスト**` |
| `斜体(テキスト)` | 文字列 | `*テキスト*` |
| `下線(テキスト)` | 文字列 | `__テキスト__` |
| `取り消し線(テキスト)` | 文字列 | `~~テキスト~~` |
| `コード(テキスト)` | 文字列 | `` `テキスト` `` |
| `コードブロック(テキスト[, 言語])` | 文字列×1-2 | コードブロック |
| `引用(テキスト)` | 文字列 | `> テキスト` |
| `スポイラー(テキスト)` | 文字列 | `\|\|テキスト\|\|` |
| `ユーザーメンション(ID)` | 文字列 | `<@ID>` |
| `チャンネルメンション(ID)` | 文字列 | `<#ID>` |
| `ロールメンション(ID)` | 文字列 | `<@&ID>` |
| `タイムスタンプ(UNIX秒[, スタイル])` | 数値[, 文字列] | `<t:unix:style>` |
| `カスタム絵文字(名前, ID[, アニメ])` | 文字列×2[, 真偽] | `<:名前:ID>` / `<a:名前:ID>` |
| `リンク(テキスト, URL)` | 文字列×2 | `[テキスト](URL)` |
| `見出し(テキスト, レベル)` | 文字列, 数値 | `# テキスト` (レベル1-3) |
| `リスト(配列[, 番号付き])` | 配列[, 真偽] | Markdownリストを生成 |

### Components V2 <sup>v2.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `テキスト表示(ID, テキスト)` | 数値, 文字列 | TextDisplay コンポーネント (type:10) |
| `セパレーター(ID[, 余白, 区切り線])` | 数値[, 真偽×2] | Separator コンポーネント (type:14) |
| `メディアギャラリー(ID, アイテム配列)` | 数値, 配列 | MediaGallery コンポーネント (type:12) |
| `メディアアイテム(URL[, 説明])` | 文字列×1-2 | MediaGalleryItem JSON生成 |
| `サムネイル(ID, URL[, 説明])` | 数値, 文字列×1-2 | Thumbnail コンポーネント (type:11) |
| `セクション(ID, コンポーネント配列[, サムネイル])` | 数値, 配列[, 文字列] | Section コンポーネント (type:9) |
| `コンテナ(ID, コンポーネント配列[, 色, スポイラー])` | 数値, 配列[, 数値, 真偽] | Container コンポーネント (type:17) |
| `ファイル表示(ID, URL)` | 数値, 文字列 | File コンポーネント (type:13) |
| `V2メッセージ送信(チャンネルID, コンポーネント配列)` | 文字列, 配列 | IS_COMPONENTS_V2 フラグ付きメッセージ送信 |

### サーバーテンプレート <sup>v2.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `テンプレート一覧(サーバーID)` | 文字列 | サーバーのテンプレート一覧 |
| `テンプレート取得(テンプレートコード)` | 文字列 | テンプレート情報を取得 |
| `テンプレート作成(サーバーID, 名前[, 説明])` | 文字列×2-3 | テンプレートを作成 |
| `テンプレート同期(サーバーID, コード)` | 文字列×2 | テンプレートをサーバーに同期 |
| `テンプレート編集(サーバーID, コード, 設定)` | 文字列×3 | テンプレートを編集 |
| `テンプレート削除(サーバーID, コード)` | 文字列×2 | テンプレートを削除 |
| `テンプレートからサーバー作成(コード, 名前)` | 文字列×2 | テンプレートから新サーバー作成 |

### オンボーディング <sup>v2.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `オンボーディング取得(サーバーID)` | 文字列 | オンボーディング設定を取得 |
| `オンボーディング設定(サーバーID, 設定)` | 文字列×2 | オンボーディングを設定 |

### サウンドボード <sup>v2.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `サウンドボード一覧(サーバーID)` | 文字列 | サーバーのサウンド一覧 |
| `サウンドボード取得(サーバーID, サウンドID)` | 文字列×2 | サウンド情報を取得 |
| `サウンドボード作成(サーバーID, 名前, データ[, 音量, 絵文字ID])` | 文字列×3[, 数値, 文字列] | サウンドを作成（base64） |
| `サウンドボード編集(サーバーID, サウンドID, 設定)` | 文字列×3 | サウンドを編集 |
| `サウンドボード削除(サーバーID, サウンドID)` | 文字列×2 | サウンドを削除 |
| `サウンドボード再生(チャンネルID, サウンドID[, ソースサーバーID])` | 文字列×2-3 | サウンドを再生 |
| `デフォルトサウンドボード一覧()` | — | Discord標準サウンド一覧 |

### ロール接続メタデータ <sup>v2.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `ロール接続メタデータ取得(アプリID)` | 文字列 | メタデータスキーマを取得 |
| `ロール接続メタデータ設定(アプリID, JSON)` | 文字列×2 | メタデータスキーマを設定 |
| `ユーザーロール接続取得(アプリID)` | 文字列 | ユーザーのロール接続を取得 |
| `ユーザーロール接続更新(アプリID, 設定)` | 文字列×2 | ユーザーのロール接続を更新 |

### エンタイトルメント / SKU <sup>v2.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `SKU一覧(アプリID)` | 文字列 | アプリのSKU一覧 |
| `エンタイトルメント一覧(アプリID)` | 文字列 | エンタイトルメント一覧 |
| `エンタイトルメント消費(アプリID, ID)` | 文字列×2 | 消耗型エンタイトルメントを消費 |
| `テストエンタイトルメント作成(アプリID, SKU, Owner, Type)` | 文字列×3, 数値 | テスト用エンタイトルメント作成 |
| `テストエンタイトルメント削除(アプリID, ID)` | 文字列×2 | テスト用エンタイトルメント削除 |

### OAuth2 <sup>v2.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `OAuth2トークン交換(クライアントID, シークレット, コード, リダイレクトURI)` | 文字列×4 | 認可コードをトークンに交換 |
| `OAuth2トークンリフレッシュ(クライアントID, シークレット, リフレッシュトークン)` | 文字列×3 | トークンをリフレッシュ |
| `OAuth2トークン無効化(クライアントID, シークレット, トークン)` | 文字列×3 | トークンを無効化 |
| `OAuth2自分情報()` | — | 現在の認証情報を取得 |
| `OAuth2認可URL生成(クライアントID, リダイレクトURI, スコープ配列)` | 文字列×2, 配列 | 認可URLを生成 |

### シャーディング <sup>v2.2</sup>

| 関数 | 引数 | 説明 |
|---|---|---|
| `シャード設定(シャードID, シャード数)` | 数値×2 | シャーディングを有効化（IDENTIFY前に設定） |
| `シャード情報()` | — | Gateway Bot情報（推奨シャード数）を取得 |
| `シャードID計算(サーバーID, シャード数)` | 文字列, 数値 | サーバーの所属シャードIDを計算 |

### モデレーション

| 関数 | 引数 | 説明 |
|---|---|---|
| `キック(サーバーID, ユーザーID[, 理由])` | 文字列×2-3 | メンバーをキック |
| `BAN(サーバーID, ユーザーID[, 理由])` | 文字列×2-3 | メンバーをBAN |
| `BAN解除(サーバーID, ユーザーID)` | 文字列×2 | BANを解除 |
| `ロール付与(サーバーID, ユーザーID, ロールID)` | 文字列×3 | ロールを付与 |
| `ロール剥奪(サーバーID, ユーザーID, ロールID)` | 文字列×3 | ロールを剥奪 |
| `ロール一覧(サーバーID)` | 文字列 | ロール一覧を取得 |
| `タイムアウト(サーバーID, ユーザーID, 秒数)` | 文字列, 文字列, 数値 | メンバーをタイムアウト（0で解除、最大28日） |

### リアクション・ステータス・ユーザー

| 関数 | 引数 | 説明 |
|---|---|---|
| `リアクション追加(チャンネルID, メッセージID, 絵文字)` | 文字列×3 | リアクションを追加 |
| `リアクション削除(チャンネルID, メッセージID, 絵文字[, ユーザーID])` | 文字列×3-4 | リアクションを削除（第4引数で他ユーザー指定可） |
| `リアクション全削除(チャンネルID, メッセージID)` | 文字列×2 | 全リアクションを削除 |
| `ステータス設定(状態[, テキスト, 種類])` | 文字列×1-3 | Botステータスを設定 |
| `自分情報()` | — | Bot自身の情報を取得 |
| `ユーザー情報(ID)` | 文字列 | ユーザー情報を取得 |
| `DM作成(ユーザーID)` | 文字列 | DMチャンネルを作成 |

---

## 📡 イベント一覧

`イベント(名前, コールバック)` で登録可能なイベント名:

| 日本語 | Discord Event | 説明 |
|---|---|---|
| `"メッセージ受信"` | MESSAGE_CREATE | メッセージ受信 |
| `"メッセージ編集"` | MESSAGE_UPDATE | メッセージ編集 |
| `"メッセージ削除イベント"` | MESSAGE_DELETE | メッセージ削除 |
| `"メンバー参加"` | GUILD_MEMBER_ADD | メンバー参加 |
| `"メンバー退出"` | GUILD_MEMBER_REMOVE | メンバー退出 |
| `"リアクション追加"` | MESSAGE_REACTION_ADD | リアクション追加 |
| `"リアクション削除"` | MESSAGE_REACTION_REMOVE | リアクション削除 |
| `"サーバー参加"` | GUILD_CREATE | サーバーに参加 |
| `"サーバー退出"` | GUILD_DELETE | サーバーから退出 |
| `"チャンネル作成"` | CHANNEL_CREATE | チャンネル作成 |
| `"チャンネル削除"` | CHANNEL_DELETE | チャンネル削除 |
| `"入力中"` | TYPING_START | 入力中 |
| `"プレゼンス更新"` | PRESENCE_UPDATE | プレゼンス更新 |
| `"ボイス状態更新"` | VOICE_STATE_UPDATE | ボイス状態変更 |
| `"ボイスサーバー更新"` | VOICE_SERVER_UPDATE | ボイスサーバー情報更新 |
| `"ボイス接続完了"` | VOICE_CONNECTED | VC接続完了（音声送信可能） |
| `"ボイス切断"` | VOICE_DISCONNECTED | VC切断完了 |
| `"音声再生完了"` | VOICE_PLAY_END | 1曲の再生が完了 |
| `"準備完了"` | READY | Bot接続完了 |
| `"再接続完了"` | RESUMED | セッション再開完了 |
| `"エラー"` | — | REST/Gateway エラー発生 |
| `"切断"` | — | Gateway 切断 |
| `"再接続"` | — | Gateway 再接続成功 |
| `"ボタンクリック"` | — | ボタンがクリックされた（ハンドラ未登録時） |
| `"セレクト選択"` | — | セレクトメニューが選択された（ハンドラ未登録時） |
| `"自動モデレーション実行"` | AUTO_MODERATION_ACTION_EXECUTION | AutoModルールが発動 |
| `"イベント作成"` | GUILD_SCHEDULED_EVENT_CREATE | スケジュールイベント作成 |
| `"イベント更新"` | GUILD_SCHEDULED_EVENT_UPDATE | スケジュールイベント更新 |
| `"イベント削除"` | GUILD_SCHEDULED_EVENT_DELETE | スケジュールイベント削除 |

> 英語のイベント名 (`MESSAGE_CREATE` 等) もそのまま使用できます。

---

## メッセージオブジェクトの構造

`メッセージ受信時` のコールバックに渡される辞書のキー:

```
{
  "ID": "1234567890...",
  "内容": "こんにちは",
  "チャンネルID": "1234567890...",
  "サーバーID": "1234567890...",
  "著者": {
    "ID": "1234567890...",
    "ユーザー名": "username",
    "表示名": "表示名",
    "アバター": "hash",
    "ボット": false
  },
  "タイムスタンプ": "2026-02-12T00:00:00.000Z",
  "メンション": [...],
  "埋め込み": [...],
  "添付ファイル": [...],
  "返信元": { ... } or null
}
```

> Discord API のキーは自動的に日本語に変換されます。

---

## 🧑‍🍳 レシピ集

### エコー Bot

```
ボット.メッセージ受信時(関数(m)
    もし m["著者"]["ボット"] != 真 なら
        ボット.返信(m, "あなた: " + m["内容"])
    終わり
終わり)
```

### ウェルカムメッセージ

```
変数 歓迎チャンネル = "1234567890123456789" // チャンネルID

ボット.参加時(関数(メンバー)
    変数 名前 = メンバー["ユーザー"]["ユーザー名"]
    変数 e = ボット.埋め込み作成()
    ボット.埋め込みタイトル(e, "🎉 ようこそ！")
    ボット.埋め込み説明(e, 名前 + " さん、サーバーへようこそ！")
    ボット.埋め込み色(e, 0x57F287)
    ボット.埋め込み送信(歓迎チャンネル, e)
終わり)
```

### 投票機能

```
もし 内容 == "!vote" なら
    変数 結果 = ボット.メッセージ送信(チャンネル, "📊 今日のランチは？")
    もし 結果 != 偽 なら
        ボット.リアクション追加(チャンネル, 結果["ID"], "🍜")
        ボット.リアクション追加(チャンネル, 結果["ID"], "🍕")
        ボット.リアクション追加(チャンネル, 結果["ID"], "🍔")
    終わり
終わり
```

### 遅延応答（重い処理）

```
ボット.コマンド登録("analyze", "データを分析する", 関数(インタラクション)
    // まず「考え中...」を表示
    ボット.コマンド遅延応答(インタラクション)

    // 重い処理をここで実行...

    // 結果を送信
    ボット.コマンドフォローアップ(インタラクション, "分析完了！結果: ...")
終わり)
```

---

## ❓ FAQ

<details>
<summary><strong>Q: トークンはどこで取得できますか？</strong></summary>

[Discord Developer Portal](https://discord.com/developers/applications) → アプリケーション選択 → 左メニュー「Bot」→ 「Reset Token」でトークンをコピーできます。

⚠️ **トークンは絶対にコードに直接書かず、環境変数で管理することを推奨します。**
</details>

<details>
<summary><strong>Q: Message Content Intent を有効にする必要がありますか？</strong></summary>

はい。`メッセージ["内容"]` を読み取るには、Developer Portal の Bot 設定で **Message Content Intent** を ON にしてください。スラッシュコマンドのみ使用する場合は不要です。
</details>

<details>
<summary><strong>Q: スラッシュコマンドが表示されません</strong></summary>

スラッシュコマンドは Bot 起動時に Discord API に登録されます。反映まで **最大1時間** かかる場合があります。開発中はギルドコマンドの使用を検討してください。
</details>

<details>
<summary><strong>Q: Bot が切断されます</strong></summary>

hajimu_discord は自動再接続をサポートしています。Gateway の切断時は自動的に Resume/Reconnect を行います。ログレベルをデバッグに設定して詳細を確認できます:

```
ボット.ログレベル設定("デバッグ")
```
</details>

<details>
<summary><strong>Q: ボイスチャンネルには対応していますか？</strong></summary>

v1.0.0 では未対応です。v2.0 で対応予定です。
</details>

<details>
<summary><strong>Q: レート制限は処理されますか？</strong></summary>

はい。REST API で 429 (Rate Limited) が返された場合、自動的に `retry_after` 秒待機してリトライします。
</details>

---

## インテント設定

```
// 文字列で指定
ボット.インテント設定("デフォルト")
ボット.インテント設定("メッセージ", "メッセージ内容", "リアクション")
ボット.インテント設定("全て") // ⚠️ 特権インテント含む

// 数値でも OK
ボット.インテント設定(32767)
```

| 名前 | 値 | 特権？ |
|---|---|---|
| `"サーバー"` | 1 | いいえ |
| `"メンバー"` | 2 | **はい** |
| `"モデレーション"` | 4 | いいえ |
| `"メッセージ"` | 512 | いいえ |
| `"メッセージ内容"` | 32768 | **はい** |
| `"リアクション"` | 1024 | いいえ |
| `"DM"` | 4096 | いいえ |
| `"プレゼンス"` | 256 | **はい** |
| `"ボイス"` | 128 | いいえ |
| `"デフォルト"` | 33280 | いいえ |
| `"全て"` | 262143 | **はい** |

> **特権インテント** は Developer Portal で有効にする必要があります。

---

## 📜 変更履歴

### v2.2.0 (2026-02-14)

**Components V2・テンプレート・サウンドボード・OAuth2・シャーディング** — +42関数

- **Components V2** (9関数): テキスト表示 / セパレーター / メディアギャラリー / メディアアイテム / サムネイル / セクション / コンテナ / ファイル表示 / V2メッセージ送信
- **サーバーテンプレート** (7関数): 一覧 / 取得 / 作成 / 同期 / 編集 / 削除 / テンプレートからサーバー作成
- **オンボーディング** (2関数): 取得 / 設定
- **サウンドボード** (7関数): 一覧 / 取得 / 作成 / 編集 / 削除 / 再生 / デフォルト一覧
- **ロール接続メタデータ** (4関数): メタデータ取得・設定 / ユーザー接続取得・更新
- **エンタイトルメント / SKU** (5関数): SKU一覧 / エンタイトルメント一覧・消費 / テスト作成・削除
- **OAuth2** (5関数): トークン交換 / リフレッシュ / 無効化 / 自分情報 / 認可URL生成
- **シャーディング** (3関数): シャード設定 / シャード情報 / シャードID計算
- Gateway IDENTIFY にシャードフィールド自動付与
- 累計 213 関数

### v2.1.0 (2026-02-15)

**ステージチャンネル・スタンプ・ユーティリティ拡張** — +33関数

- **ステージチャンネル管理**: ステージ開始 / 編集 / 終了 / 情報取得
- **スタンプ管理**: 一覧 / 取得 / 作成（マルチパート） / 編集 / 削除
- **ウェルカム画面**: 取得 / 編集
- **サーバー・ロール管理**: サーバー編集 / ロール作成 / ロール編集 / ロール削除
- **フォーラムチャンネル**: フォーラム投稿（タグ対応） / タグ一覧取得
- **Markdownユーティリティ** (16関数): 太字 / 斜体 / 下線 / 取り消し線 / コード / コードブロック / 引用 / スポイラー / ユーザーメンション / チャンネルメンション / ロールメンション / タイムスタンプ / カスタム絵文字 / リンク / 見出し / リスト
- 累計 171 関数

### v2.0.0 (2026-02-15)

**ボイスチャンネル対応** — +11関数

- **VC接続 / VC切断**: ボイスチャンネルへの参加・退出
- **音声再生**: WAV/MP3/OGG等のファイル再生（ffmpeg対応）
- **音声停止 / 一時停止 / 再開 / スキップ**: 再生制御
- **音声キュー管理**: 複数曲の順次再生
- **音声ループ**: リピート再生モード
- **VC状態**: 接続状態・再生状況の取得
- **音声音量**: Opusビットレート調整（音量制御）
- Voice Gateway + UDP + RTP + XSalsa20-Poly1305 暗号化
- Opus エンコーダー（48kHz, ステレオ, 20ms フレーム）
- IP Discovery 自動認識
- 依存追加: libopus, libsodium
- 累計 ~135 関数

### v1.7.1 (2026-02-14)

**セキュリティ修正 & バグ修正**

- **[セキュリティ]** JSONインジェクション脆弱性を修正 — チャンネル作成/編集/スレッド作成/招待作成/Webhook作成・送信/ファイル送信 で `json_escape_str` を使用するように変更
- **[セキュリティ]** WebSocket ペイロード長チェック追加 (16MB上限) — DoS攻撃防止
- **[バグ修正]** `AutoMod実行時` 関数の `event_find(NULL)` による未定義動作・クラッシュを修正
- **[バグ修正]** `BAN` 関数の未初期化 `StrBuf` 解放によるクラッシュを修正
- **[バグ修正]** AUTO_MODERATION / GUILD_SCHEDULED_EVENT 系イベントの二重発火を修正
- **[堅牢性]** `malloc`/`calloc` NULL チェック追加: base64_encode、WebSocket送受信、JSON変換、REST API、絵文字読み込み
- **[堅牢性]** `fn_emoji_create` の `fread` 戻り値チェック追加
- 累計 ~124 関数（変更なし）

### v1.7.0 (2026-02-14)

**監査ログ & AutoModeration** — +16関数

- 監査ログ取得（種類/件数フィルタ対応）
- AutoModeration: ルール作成 / 一覧 / 取得 / 編集 / 削除 / 実行時イベント
- 絵文字: 一覧 / 作成（Base64画像アップロード）/ 削除
- スケジュールイベント: 作成 / 編集 / 削除 / 一覧
- 投票: 作成（複数選択対応）/ 即時終了
- Gateway: AUTO_MODERATION_ACTION_EXECUTION / GUILD_SCHEDULED_EVENT_* イベント
- 累計 ~124 関数

### v1.6.0 (2026-02-14)

**コレクター & キャッシュ** — +6関数

- メッセージコレクター: チャンネル内メッセージをブロッキング収集
- リアクションコレクター: 特定メッセージのリアクションを収集
- インタラクションコレクター: コンポーネントインタラクションを収集
- メンバー一覧取得（最大1000件）/ メンバー検索
- サーバー一覧取得
- 累計 ~108 関数

### v1.5.0 (2026-02-14)

**Webhook & ファイル添付** — +5関数

- Webhook: 作成 / 一覧 / 削除 / 送信（カスタム名・アバター対応）
- ファイル添付送信（multipart/form-data, curl_mime API 使用）
- 累計 ~102 関数

### v1.4.0 (2026-02-14)

**チャンネル & スレッド管理** — +13関数

- チャンネル作成（テキスト/ボイス/カテゴリ/ニュース/ステージ/フォーラム）/ 編集 / 削除
- スレッド: 作成 / 参加 / 退出 / メンバー追加 / メンバー削除
- 権限オーバーライド設定（ロール/メンバー単位）
- 招待: 作成 / 一覧 / 削除 / 情報取得
- 累計 ~97 関数

### v1.3.0 (2026-02-14)

**モーダル & 高度なコマンド** — +11関数

- モーダル（フォーム）: 作成・テキスト入力追加・表示・送信時ハンドラ
- サブコマンド / サブコマンドグループ登録
- オートコンプリート（入力補完）ハンドラ・応答
- コンテキストメニュー（右クリックメニュー）: ユーザー / メッセージ
- コマンドオプション選択肢
- 累計 ~89 関数

### v1.2.0 (2026-02-14)

**メッセージコンポーネント** — +13関数

- ボタン: 作成 / リンクボタン / 無効化
- アクション行: 作成 / ボタン追加 / メニュー追加
- コンポーネント付きメッセージ送信
- セレクトメニュー: 作成 / 選択肢追加
- イベントハンドラ: ボタン時 / セレクト時
- インタラクション更新 / 遅延更新
- エフェメラル応答（`コマンド応答` 第3引数）

### v1.1.0 (2026-02-14)

**メッセージ操作の完全化** — +12関数

- メッセージ取得 / メッセージ履歴 / メッセージ一括削除（件数指定）
- ピン解除 / ピン一覧
- リアクション全削除 / 他ユーザーのリアクション削除
- タイムアウト（通信無効化、最大28日）
- エラー時 / 切断時 / 再接続時 イベントハンドラ
- メッセージ編集が辞書を返すように改善
- Gateway/REST のエラーイベント発火

### v1.0.0 (2026-02-12)

🎉 **初回リリース**

- Discord Gateway API v10 対応 (WebSocket + zlib-stream)
- Discord REST API v10 対応 (libcurl)
- 自動再接続 (Resume/Reconnect)
- 自動レート制限処理
- 完全日本語 API (55関数)
- イベントシステム (16種の日本語イベント名)
- 埋め込み (Embed) ビルダー
- スラッシュコマンド登録・応答
- モデレーション (キック/BAN/ロール管理)
- リアクション追加・削除
- DM 送信
- ステータス/プレゼンス設定

### ロードマップ

- ~~**v1.1** — メッセージ操作完全化・タイムアウト・エラーイベント~~ ✅
- ~~**v1.2** — ボタン・セレクトメニュー・コンポーネント・エフェメラル~~ ✅
- ~~**v1.3** — モーダル・サブコマンド・コンテキストメニュー・オートコンプリート~~ ✅
- ~~**v1.4** — チャンネル管理・スレッド・権限オーバーライド・招待~~ ✅
- ~~**v1.5** — Webhook・ファイル添付~~ ✅
- ~~**v1.6** — コレクター・メンバー管理・サーバー一覧~~ ✅
- ~~**v1.7** — 監査ログ・AutoModeration・絵文字・イベント・投票~~ ✅
- ~~**v2.0** — ボイスチャンネル対応 (Opus/Sodium)~~ ✅
- ~~**v2.1** — ステージチャンネル・スタンプ・フォーラム・Markdown~~ ✅
- ~~**v2.2** — Components V2・テンプレート・サウンドボード・OAuth2・シャーディング~~ ✅

---

## 📄 ライセンス

MIT License — 詳細は [LICENSE](LICENSE) を参照

---

<p align="center">
  <sub>はじむ言語で Discord Bot を作ろう 🤖</sub>
</p>
